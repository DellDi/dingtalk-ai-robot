# ÈíâÈíâAIÊú∫Âô®‰∫∫

## üìù È°πÁõÆÊ¶ÇËø∞

‰∏Ä‰∏™Âü∫‰∫éÈíâÈíâÂºÄÊîæÂπ≥Âè∞ÁöÑÊô∫ËÉΩÊú∫Âô®‰∫∫Á≥ªÁªüÔºåÈõÜÊàêAIÈóÆÁ≠î„ÄÅÁü•ËØÜÂ∫ìÊ£ÄÁ¥¢„ÄÅJIRA‰ªªÂä°ÁÆ°ÁêÜÂíåÊúçÂä°Âô®Áª¥Êä§ÂäüËÉΩ„ÄÇ‰ΩøÁî®Python 3.12ÂíåFastAPIÊûÑÂª∫ÔºåÈááÁî®ÂæÆËΩØAutoGenÊ°ÜÊû∂ÂÆûÁé∞Êô∫ËÉΩÂåñ‰∫§‰∫í„ÄÇ

## üöÄ ‰∏ªË¶ÅÂäüËÉΩ

```mermaid
sequenceDiagram
    actor User as Áî®Êà∑
    participant Bot as ÈíâÈíâAIÊú∫Âô®‰∫∫
    participant AI as AutoGenÂ§öÊô∫ËÉΩ‰Ωì
    participant KB as Áü•ËØÜÂ∫ìÁ≥ªÁªü
    participant Ticket as Â∑•ÂçïÁ≥ªÁªü
    participant JIRA as JIRAÂπ≥Âè∞
    participant Server as ÊúçÂä°Âô®Á≥ªÁªü
    
    User->>Bot: ÂèëÈÄÅÊ∂àÊÅØ
    
    %% AIÊô∫ËÉΩÈóÆÁ≠îÊµÅÁ®ã
    alt AIÊô∫ËÉΩÈóÆÁ≠î
        Bot->>AI: ËΩ¨ÂèëÁî®Êà∑ÈóÆÈ¢ò
        AI->>AI: Â§öÊô∫ËÉΩ‰ΩìÂçè‰ΩúÂ§ÑÁêÜ
        AI->>Bot: ËøîÂõûÊô∫ËÉΩÂõûÂ§ç
        Bot->>User: Â±ïÁ§∫AIÂõûÁ≠î
    
    %% Áü•ËØÜÂ∫ìÊ£ÄÁ¥¢ÊµÅÁ®ã
    else Áü•ËØÜÂ∫ìÊ£ÄÁ¥¢
        Bot->>KB: Êü•ËØ¢Áõ∏ÂÖ≥Áü•ËØÜ
        KB->>KB: ÂêëÈáèÊï∞ÊçÆÂ∫ìÊ£ÄÁ¥¢
        KB->>Bot: ËøîÂõûÊ£ÄÁ¥¢ÁªìÊûú
        Bot->>User: Â±ïÁ§∫Áü•ËØÜÂ∫ìÁ≠îÊ°à
    
    %% Âø´Êç∑ÊèêÂçïÊµÅÁ®ã
    else Âø´Êç∑ÊèêÂçï
        Bot->>Ticket: ÂàõÂª∫Â∑•ÂçïËØ∑Ê±Ç
        Ticket->>Ticket: Â∑•ÂçïËá™Âä®ÂàõÂª∫
        Ticket->>Bot: ËøîÂõûÂ∑•ÂçïÁä∂ÊÄÅ
        Bot->>User: Â±ïÁ§∫Â∑•ÂçïÂàõÂª∫ÁªìÊûú
    
    %% JIRA‰ªªÂä°ÁÆ°ÁêÜÊµÅÁ®ã
    else JIRA‰ªªÂä°ÁÆ°ÁêÜ
        Bot->>JIRA: ÂÆöÊó∂Ê£ÄÊü•‰ªªÂä°
        JIRA->>JIRA: ÊâßË°åËßÑÂàôÊ£ÄÊü•
        JIRA->>Bot: ËøîÂõûÊ£ÄÊü•ÁªìÊûú
        Bot->>User: Êé®ÈÄÅÂç°ÁâáÈÄöÁü•
        Bot->>JIRA: ÂàõÂª∫ÂæÖÂäû‰ªªÂä°
    
    %% ÊúçÂä°Âô®ÁÆ°ÁêÜÊµÅÁ®ã
    else ÊúçÂä°Âô®ÁÆ°ÁêÜ
        Bot->>Server: ÊâßË°åÁÆ°ÁêÜÂëΩ‰ª§
        Server->>Server: ÊâßË°åSSHÊìç‰Ωú/DifyÂçáÁ∫ß
        Server->>Bot: ËøîÂõûÊâßË°åÁªìÊûú
        Bot->>User: Â±ïÁ§∫Êìç‰ΩúÁªìÊûú
        Server->>Bot: ÂèëÈÄÅÊó•ÂøóÊï∞ÊçÆ
        Bot->>AI: ÂàÜÊûêÊó•ÂøóÊï∞ÊçÆ
        AI->>Bot: ËøîÂõûÂàÜÊûêÁªìÊûú
        Bot->>User: Â±ïÁ§∫Êó•Êä•/Âë®Êä•
    end
```

### Ê†∏ÂøÉÂäüËÉΩ

1. **Êú∫Âô®‰∫∫AIÊô∫ËÉΩÈóÆÁ≠îÂíåÂõûÂ§ç**
   - Âü∫‰∫éÂæÆËΩØAutoGenÂ§öÊô∫ËÉΩ‰ΩìÊû∂ÊûÑ
   - ÊîØÊåÅ‰∏ä‰∏ãÊñáÁêÜËß£ÂíåËøûÁª≠ÂØπËØù

2. **Áü•ËØÜÂ∫ìÊ£ÄÁ¥¢ÈóÆÁ≠î**
   - ÊîØÊåÅÂØπÊé•‰ºÅ‰∏öÁü•ËØÜÂ∫ì
   - Êèê‰æõÁ≤æÂáÜ‰ø°ÊÅØÊ£ÄÁ¥¢ÂíåÂõûÁ≠î

3. **Âø´Êç∑ÊèêÂçïÂäüËÉΩ**
   - Áæ§ËÅä‰∏≠Âø´ÈÄüÂàõÂª∫Â∑•Âçï
   - Ëá™ÂÆö‰πâÊ®°ÊùøÊîØÊåÅ

4. **JIRA‰ªªÂä°ÁÆ°ÁêÜ**
   - ÂÆöÊó∂Ê£ÄÊü•JIRA‰ªªÂä°ËßÑËåÉÊÄß
   - Áæ§ÂÜÖÊé®ÈÄÅÂç°ÁâáÈÄöÁü•
   - Ëá™Âä®ÂàõÂª∫Áõ∏ÂÖ≥‰∫∫ÂëòÂæÖÂäû

5. **ÊúçÂä°Âô®Áª¥Êä§Âä©Êâã**
   - SSHËøúÁ®ãÊìç‰ΩúÊîØÊåÅ
   - DifyÊúçÂä°Ëá™Âä®ÂåñÂçáÁ∫ß
   - AIÈ©±Âä®ÁöÑÊó•ÂøóÂàÜÊûê‰∏éÊÄªÁªì

6. **AIÊô∫ËÉΩÊó•Êä•/Âë®Êä•**
   - ÊØèÂ§©ÁöÑÊó•Êä•ÔºåAIÊô∫ËÉΩÂàÜÊûê
   - ÊØèÂë®‰∫îÊ†πÊçÆÊú¨Âë®ÁöÑÊØèÂ§©ÁöÑÊó•Êä•ÔºåÁîüÊàêÊú¨Âë®ÁöÑÂë®Êä•ÔºàAIÊô∫ËÉΩÂàÜÊûêÔºâ
   - ÁîüÊàêÂêéÂÆöÊó∂ÂÆöÁÇπÊé®ÈÄÅ

## üõ†Ô∏è ÊäÄÊúØÊû∂ÊûÑ

- **ÂêéÁ´ØÊ°ÜÊû∂**ÔºöFastAPI
- **Êô∫ËÉΩ‰ΩìÂºïÊìé**ÔºöMicrosoft AutoGen
- **‰æùËµñÁÆ°ÁêÜ**Ôºöuv (PythonÂåÖÁÆ°ÁêÜÂ∑•ÂÖ∑)
- **ÂºÄÂèëÁéØÂ¢É**ÔºöPython 3.12+
- **Âπ≥Âè∞ÈõÜÊàê**ÔºöÈíâÈíâÂºÄÊîæÂπ≥Âè∞„ÄÅJIRA API

## üîß ÂÆâË£Ö‰∏éÈÖçÁΩÆ

### ÁéØÂ¢ÉË¶ÅÊ±Ç

- Python 3.12+
- uv (Êé®ËçêÁöÑÂåÖÁÆ°ÁêÜÂ∑•ÂÖ∑)

### ÂÆâË£ÖÊ≠•È™§

1. ÂÖãÈöÜ‰ªìÂ∫ì

```bash
git clone [‰ªìÂ∫ìÂú∞ÂùÄ]
cd dingtalk-ai-robot
```

2. ÂÆâË£Ö‰æùËµñ

```bash
# ‰ΩøÁî®uvÂÆâË£Ö‰æùËµñ
uv pip install -e .

# ÊàñËÄÖ‰ΩøÁî®‰º†ÁªüÊñπÂºè
uv pip compile pyproject.toml -o requirements.txt
pip install -r requirements.txt
```

3. ÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè

ÂàõÂª∫`.env`Êñá‰ª∂ÔºåÂèÇËÄÉ`.env.example`‰∏≠ÁöÑÁ§∫‰æãÔºåÈÖçÁΩÆÂøÖË¶ÅÁöÑÁéØÂ¢ÉÂèòÈáè„ÄÇ

### ÂêØÂä®ÊúçÂä°

```bash
# ‰ΩøÁî®uvËøêË°å
uv run -m app.main

# ÊàñËÄÖ‰ΩøÁî®‰º†ÁªüÊñπÂºè
python -m app.main
```

## üìö ‰ΩøÁî®ÊåáÂçó

### Êú∫Âô®‰∫∫ÈÖçÁΩÆ

1. Âú®[ÈíâÈíâÂºÄÂèëËÄÖÂπ≥Âè∞](https://open-dev.dingtalk.com)ÂàõÂª∫Êú∫Âô®‰∫∫Â∫îÁî®
2. ÈÖçÁΩÆÊú∫Âô®‰∫∫ÊùÉÈôêÂíåÂõûË∞ÉÂú∞ÂùÄ
3. Ëé∑ÂèñClientID„ÄÅClientSecretÂíåRobotCode

### ÂäüËÉΩ‰ΩøÁî®

1. **AIÈóÆÁ≠î**ÔºöÂú®Áæ§ËÅä‰∏≠@Êú∫Âô®‰∫∫Âπ∂ÊèêÈóÆ
2. **Áü•ËØÜÂ∫ìÊ£ÄÁ¥¢**Ôºö‰ΩøÁî®ÁâπÂÆöÊåá‰ª§Ëß¶ÂèëÁü•ËØÜÂ∫ìÊêúÁ¥¢
3. **ÊèêÂçïÂäüËÉΩ**ÔºöÊåâÊ†ºÂºèÂèëÈÄÅÊèêÂçï‰ø°ÊÅØ
4. **JIRAÁÆ°ÁêÜ**ÔºöÁ≥ªÁªüËá™Âä®ÊâßË°åÂÆöÊó∂Ê£ÄÊü•
5. **ÊúçÂä°Âô®Áª¥Êä§**Ôºö‰ΩøÁî®ÊåáÂÆöÂëΩ‰ª§Ëß¶ÂèëÊúçÂä°Âô®Êìç‰Ωú

## üß© È°πÁõÆÁªìÊûÑ

```
dingtalk-ai-robot/
‚îú‚îÄ‚îÄ app/                    # ‰∏ªÂ∫îÁî®ÁõÆÂΩï
‚îÇ   ‚îú‚îÄ‚îÄ api/                # APIÁ´ØÁÇπ
‚îÇ   ‚îú‚îÄ‚îÄ core/               # Ê†∏ÂøÉÈÖçÁΩÆÂíåÂäüËÉΩ
‚îÇ   ‚îú‚îÄ‚îÄ services/           # ÊúçÂä°Ê®°Âùó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai/             # AIÊô∫ËÉΩ‰Ωì
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dingtalk/       # ÈíâÈíâAPIÈõÜÊàê
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jira/           # JIRAÊúçÂä°
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ knowledge/      # Áü•ËØÜÂ∫ìÊúçÂä°
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ssh/            # SSHÊúçÂä°
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # Â∫îÁî®ÂÖ•Âè£
‚îú‚îÄ‚îÄ tests/                  # ÊµãËØïÁõÆÂΩï
‚îú‚îÄ‚îÄ .env.example            # ÁéØÂ¢ÉÂèòÈáèÁ§∫‰æã
‚îú‚îÄ‚îÄ pyproject.toml          # È°πÁõÆÈÖçÁΩÆÂíå‰æùËµñ
‚îú‚îÄ‚îÄ CHANGELOG.md            # ÂèòÊõ¥Êó•Âøó
‚îî‚îÄ‚îÄ README.md               # È°πÁõÆËØ¥Êòé
```

## üß† Êú¨Âú∞Áü•ËØÜÊ£ÄÁ¥¢Âô® (`KnowledgeRetriever`)

`KnowledgeRetriever` ÊúçÂä°Êèê‰æõ‰∫Ü‰ΩøÁî®ÊñáÊú¨ÂµåÂÖ•Êù•ÊûÑÂª∫ÂíåÊü•ËØ¢Êú¨Âú∞Áü•ËØÜÂ∫ìÁöÑÂäüËÉΩ„ÄÇÂÆÉÂà©Áî®ÂæÆËΩØ AutoGen ÁöÑ `ChromaDBVectorMemory` ËøõË°åÊåÅ‰πÖÂåñÂêëÈáèÂ≠òÂÇ®ÔºåÂπ∂‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑ `TongyiQWenHttpEmbeddingFunction` ÈÄöËøáÈÄö‰πâÂçÉÈóÆ V3 ÊñáÊú¨ÂµåÂÖ• API (HTTPÁ´ØÁÇπ) ÁîüÊàêÂµåÂÖ•„ÄÇËøôÁßçÊñπÊ≥ïÈÅøÂÖç‰∫ÜÂØπÂµåÂÖ•Ê®°ÂûãÁöÑÁõ¥Êé•SDK‰æùËµñ„ÄÇ

### ‚ú® ÁâπÊÄß

-   **ÂºÇÊ≠•Êìç‰Ωú**: ÂÆåÂÖ®ÂºÇÊ≠•ÁöÑËÆæËÆ°ÔºåÁî®‰∫éÂàùÂßãÂåñ„ÄÅÊñáÊ°£Ê∑ªÂä†„ÄÅÊêúÁ¥¢ÂíåËµÑÊ∫êÊ∏ÖÁêÜÔºåÈÄÇÁî®‰∫éAutoGenÂ§öÊô∫ËÉΩ‰ΩìÁ≥ªÁªü„ÄÇ
-   **Ëá™ÂÆö‰πâÈÄö‰πâÂçÉÈóÆÂµåÂÖ•**: ‰ΩøÁî® `aiohttp` Áõ¥Êé•Ë∞ÉÁî®ÈÄö‰πâÂçÉÈóÆÂµåÂÖ•APIÔºåÁ°Æ‰øù‰∫ÜÂµåÂÖ•ÁîüÊàêÁöÑÁÅµÊ¥ªÊÄßÂπ∂ÊúÄÂ∞èÂåñÂ§ñÈÉ®‰æùËµñ„ÄÇ
-   **ÊåÅ‰πÖÂåñÂêëÈáèÂ≠òÂÇ®**: ‰ΩøÁî® `ChromaDBVectorMemory` ËøõË°åÊåÅ‰πÖÂåñÂ≠òÂÇ®ÔºåÂÖÅËÆ∏Áü•ËØÜÂ∫ìÂú®‰∏çÂêå‰ºöËØùÈó¥‰øùÂ≠òÂíåÂä†ËΩΩ„ÄÇ
-   **ÂèØÈÖçÁΩÆÊÄß**: ÂÖ≥ÈîÆÂèÇÊï∞ÔºàÂ¶ÇAPIÂØÜÈí•„ÄÅÊ®°ÂûãÂêçÁß∞„ÄÅAPIÁ´ØÁÇπÂíåÊï∞ÊçÆÂ∫ìË∑ØÂæÑÔºâÈÄöËøá `app.core.config.settings` ÂíåÁéØÂ¢ÉÂèòÈáèËøõË°åÁÆ°ÁêÜ„ÄÇ
-   **ÂµåÂÖ•‰∏ÄËá¥ÊÄß**: Á°Æ‰øùÂú®Á¥¢ÂºïÊñáÊ°£ÂíåÊü•ËØ¢Êó∂‰ΩøÁî®Áõ∏ÂêåÁöÑÂµåÂÖ•Ê®°ÂûãÔºåËøôÂØπ‰∫éÊ£ÄÁ¥¢ÂáÜÁ°ÆÊÄßËá≥ÂÖ≥ÈáçË¶Å„ÄÇ
-   **ÊâπÈáèÂµåÂÖ•ÊïàÁéá**: Âà©Áî®ÈÄö‰πâÂçÉÈóÆAPIÁöÑÊâπÈáèÂµåÂÖ•ËÉΩÂäõÔºåÊèêÈ´òÂ§ÑÁêÜÂ§ö‰∏™ÊñáÊ°£Êó∂ÁöÑÊÄßËÉΩ„ÄÇ

### üõ†Ô∏è ÈÖçÁΩÆ

`KnowledgeRetriever` ‰æùËµñ‰ª•‰∏ãÈÖçÁΩÆ (ÈÄöÂ∏∏ÈÄöËøáÁéØÂ¢ÉÂèòÈáèÊàñÁî± `pydantic-settings` Âä†ËΩΩÁöÑ `.env` Êñá‰ª∂ËøõË°åÈÖçÁΩÆ):

-   `TONGYI_API_KEY`: ‰Ω†ÁöÑÈÄö‰πâÂçÉÈóÆAPIÂØÜÈí•„ÄÇ
-   `TONGYI_EMBEDDING_MODEL_NAME`: Ë¶Å‰ΩøÁî®ÁöÑÁâπÂÆöÈÄö‰πâÂµåÂÖ•Ê®°Âûã (‰æãÂ¶ÇÔºå`text-embedding-v4`)„ÄÇÈªòËÆ§‰∏∫ `"text-embedding-v4"`„ÄÇ
-   `TONGYI_EMBEDDING_API_ENDPOINT`: ÈÄö‰πâÂµåÂÖ•APIÁöÑHTTPÁ´ØÁÇπ„ÄÇÈªòËÆ§‰∏∫ `"https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings"`„ÄÇ
-   `VECTOR_DB_PATH`: ChromaDBÊåÅ‰πÖÂåñÂÖ∂Êï∞ÊçÆÁöÑÊú¨Âú∞Êñá‰ª∂Á≥ªÁªüË∑ØÂæÑ„ÄÇÈªòËÆ§‰∏∫ `"./.chroma_test_db"` (Â¶ÇÁ§∫‰æã‰∏≠‰ΩøÁî®ÔºåÂèØ‰ª•ÈÖçÁΩÆ)„ÄÇ

### üèóÔ∏è Architecture and Data Flow

```mermaid
graph TD
    A[USER/Application] --> KR{KnowledgeRetriever};

    subgraph KnowledgeRetriever [KnowledgeRetriever Service]
        direction LR
        KR_Init[initialize()] --> EF{                               };
        KR_Init --> VM{ChromaDBVectorMemory};
        EF -.-> HTTP_API[Tongyi QWen HTTP API];
        EF --> AIOHTTP[aiohttp.ClientSession];
        VM -.-> DB[ChromaDB Persistent Storage];
    end
    
    Settings[app.core.config.settings] -.-> KR_Init;
    Settings -.-> EF;

    A -- Add Documents (List<Dict>) --> KR_Add[add_documents()];
    KR_Add -- Texts to Embed --> EF;
    EF -- Embeddings --> KR_Add;
    KR_Add -- MemoryContent to Add --> VM;
    
    A -- Search(query_text) --> KR_Search[search()];
    KR_Search -- Query to Embed --> EF;
    EF -- Query Embedding --> KR_Search;
    KR_Search -- Embedded Query --> VM;
    VM -- MemoryQueryResult --> KR_Search;
    KR_Search -- Formatted Results (List<Dict>) --> A;

    A -- Close --> KR_Close[close()];
    KR_Close --> EF_Close[EF.close_session()];
    EF_Close --> AIOHTTP;
    KR_Close --> VM_Close[VM.close()];

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style KR fill:#bbf,stroke:#333,stroke-width:2px
    style HTTP_API fill:#ff9,stroke:#333,stroke-width:2px
    style DB fill:#9cf,stroke:#333,stroke-width:2px
    style Settings fill:#lightgrey,stroke:#333,stroke-width:2px
```

### üì¶ Dependencies

-   `autogen-core`
-   `autogen-extensions` (specifically for `ChromaDBVectorMemory`)
-   `chromadb`
-   `aiohttp` (newly added for HTTP calls to Tongyi API)
-   `loguru`
-   `pydantic`

### üöÄ Example Usage

(Adapted from `app/services/knowledge/retriever.py`)

```python
import asyncio
from app.services.knowledge.retriever import KnowledgeRetriever
from app.core.config import settings # Ensure settings are loaded

async def main():
    # Ensure TONGYI_API_KEY is set in your environment or .env file
    if not settings.TONGYI_API_KEY:
        print("Á§∫‰æãÁî®Ê≥ï‰∏≠Ê≠¢ÔºöËØ∑ÈÖçÁΩÆÈÄö‰πâÂçÉÈóÆAPIÂØÜÈí•„ÄÇ")
        return

    retriever = KnowledgeRetriever(
        collection_name="my_knowledge_base",
        persistence_path="./.my_chroma_db", # Example path
        tongyi_api_key=settings.TONGYI_API_KEY,
        tongyi_api_endpoint=settings.TONGYI_EMBEDDING_API_ENDPOINT,
        embedding_model_name=settings.TONGYI_EMBEDDING_MODEL_NAME
    )

    try:
        await retriever.initialize()
        print("KnowledgeRetriever initialized.")

        documents_to_add = [
            {"content": "AutoGen is a framework for building multi-agent applications.", "metadata": {"source": "doc1"}},
            {"content": "ChromaDB is a vector store used for similarity search.", "metadata": {"source": "doc2"}},
            {"content": "The Tongyi QWen API provides powerful text embedding models.", "metadata": {"source": "doc3"}},
        ]
        await retriever.add_documents(documents_to_add)
        print(f"Added {len(documents_to_add)} documents.")

        query1 = "What is AutoGen?"
        results1 = await retriever.search(query1)
        print(f"Search results for '{query1}':")
        for res in results1:
            print(f"  Content: {res['content']}, Metadata: {res['metadata']}")

        query2 = "Tell me about vector databases."
        results2 = await retriever.search(query2)
        print(f"Search results for '{query2}':")
        for res in results2:
            print(f"  Content: {res['content']}, Metadata: {res['metadata']}")

    except Exception as e:
        print(f"An error occurred: {e}")
    finally:
        await retriever.close()
        print("KnowledgeRetriever closed.")

if __name__ == "__main__":
    asyncio.run(main())
```

## üìã ÂºÄÂèëËÆ°Âàí

- [ ] Êú∫Âô®‰∫∫AIÊô∫ËÉΩÈóÆÁ≠îÂíåÂõûÂ§ç
- [ ] Êú∫Âô®‰∫∫ÈóÆÁ≠îÂèØ‰ª•ÂØπÊé•Áü•ËØÜÂ∫ìËøõË°åÊ£ÄÁ¥¢ÂõûÂ§ç
- [ ] Âø´Êç∑ÊâπÈáèÊèêÂçïÂäüËÉΩÁöÑÈõÜÊàê
- [ ] ÂÆöÊó∂Ê£ÄÊü•ÁªÑÂÜÖJIRAÂçïÁ¨¶ÂêàÊ†áÂáÜËßÑÂàô
  - [ ] Áæ§ÂÜÖÊé®ÈÄÅÂç°ÁâáÂΩ¢ÊÄÅ
  - [ ] ÂàõÂª∫ÂØπÂ∫î‰∫∫ÁöÑÂæÖÂäû
- [ ] ÂØπËØùÊú∫Âô®‰∫∫ÂèØ‰ª•Ëá™Âä®Êô∫ËÉΩÂçáÁ∫ßÂ§öÂè∞ÊúçÂä°Âô®ÁöÑDifyÊúçÂä°
- [ ] ÊØèÂë®‰∫îÊ†πÊçÆÊú¨Âë®ÁöÑÊØèÂ§©ÁöÑÊó•Êä•ÔºåÁîüÊàêÊú¨Âë®ÁöÑÂë®Êä•ÔºàAIÊô∫ËÉΩÂàÜÊûêÔºâ

## ü§ù Ë¥°ÁåÆÊåáÂçó

Ê¨¢ËøéÊèê‰∫§ÈóÆÈ¢òÊä•Âëä„ÄÅÂäüËÉΩËØ∑Ê±ÇÊàñ‰ª£Á†ÅË¥°ÁåÆ„ÄÇËØ∑Á°Æ‰øùÈÅµÂæ™È°πÁõÆÁöÑ‰ª£Á†ÅËßÑËåÉÂíåÊèê‰∫§ÊµÅÁ®ã„ÄÇ

## üìÑ ËÆ∏ÂèØËØÅ

[MIT License](LICENSE)

## üì§ ÊñáÊ°£‰∏ä‰º†Êé•Âè£ (`/upload_document`)

Êú∫Âô®‰∫∫ÊîØÊåÅÂ∞ÜÊú¨Âú∞ÊñáÊ°£ÂµåÂÖ•Âà∞Áü•ËØÜÂ∫ìÔºåÁõÆÂâçÊîØÊåÅ **txt / pdf / docx / md** ÂõõÁßçÊ†ºÂºè„ÄÇ

```http
POST /api/v1/upload_document
Content-Type: multipart/form-data

# form-data Â≠óÊÆµ
file=<Êú¨Âú∞Êñá‰ª∂>
collection=<ÂèØÈÄâÔºåËá™ÂÆö‰πâÈõÜÂêàÂêçÔºåÈªòËÆ§ global_knowledge_base>
chunk_size=<ÂèØÈÄâÔºåÈªòËÆ§ 1500>
overlap=<ÂèØÈÄâÔºåÈªòËÆ§ 200>
```

ÊàêÂäüÂìçÂ∫îÁ§∫‰æã
```json
{
  "code": 0,
  "msg": "uploaded & embedded 12 chunks",
  "data": {
    "collection": "global_knowledge_base",
    "doc_id": "f6e21..."
  }
}
```

> üìå ÈªòËÆ§ÂàáÁâáÁ≠ñÁï•‰∏∫ **Ëá™ÁÑ∂ÊÆµ + ÊªëÁ™ó**ÔºåÂèØÈÄöËøá `chunk_size / overlap` Ë¶ÜÁõñ„ÄÇ

## ‚öôÔ∏è LLM ÈÖçÁΩÆÊ≥®ÊÑè‰∫ãÈ°π

Ëá™ **AutoGen 0.6+** Ëµ∑ÔºåËã•‰∏ÄÊ¨°ÂØπËØù‰∏≠ÂåÖÂê´Â§öÊù°‰∏î‰∏çËøûÁª≠ÁöÑ *system* promptÔºåÈúÄË¶ÅÂú® `model_info` ‰∏≠ÊòæÂºèÂºÄÂêØÔºö

```python
"multiple_system_messages": True
```

Êú¨È°πÁõÆÂ∑≤Âú® `app/services/ai/openai_client.py` ‰∏≠ËÆæÁΩÆÔºåÈÅøÂÖçÂá∫Áé∞
`ValueError: Multiple and Not continuous system messages ...`„ÄÇ
